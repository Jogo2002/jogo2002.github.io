---
title: "Project 3: Is Silver More Volatile Than Gold (August–October)?"
author: "Josh Goldhaber"
format:
  html:
    code-fold: true
    theme: flatly
---

## Introduction

In this project, I investigate whether **silver is more volatile than gold** over recent months.  
Gold and silver are both precious metals often used as investment hedges against inflation and market risk, but their price behaviors differ: gold functions more as a monetary store of value, while silver also has heavy industrial demand.

Determining which metal trades at a **"volatility premium"** — that is, which has a higher expected volatility — is important to assess the **stable liquidity** of gold vs. silver. This is especially useful when evaluating which metal serves as a more effective **portfolio hedge** under uncertainty.

Using daily price data from **Yahoo Finance** (tickers `GC=F` for gold and `SI=F` for silver), I compute daily log returns and perform a one-tailed permutation test under the null hypothesis that the two metals have equal volatility.

Because financial returns are often non-normal, a permutation test is a robust, simulation-based way to test this difference without assuming normality.

---

## Experiment Setup

We compare the **standard deviations of daily log returns** for gold and silver.

- **Null Hypothesis (H₀):** The standard deviation of daily returns is the same for gold and silver.  

- **Alternative Hypothesis (H₁):** Silver is **more volatile** than gold.  

Instead of relying on a theoretical distribution (like a t-test or F-test), we use a **permutation test**, which simulates what differences we’d expect **purely due to chance** under the null hypothesis.

---

## Load Packages and Prepare Data

We use `quantmod` to pull daily futures data from Yahoo Finance and `tidyverse` for data wrangling. Log returns are computed using `dailyReturn(..., type = "log")` for stability and symmetry.

```{r setup, message=FALSE, warning=FALSE}
library(quantmod)
library(tidyverse)
library(infer)
library(purrr)

# Download daily futures prices (August 2025 – Present)
getSymbols("GC=F", src = "yahoo", from = "2025-08-01", to = Sys.Date())
getSymbols("SI=F", src = "yahoo", from = "2025-08-01", to = Sys.Date())

# Compute log returns
gold_ret <- dailyReturn(Cl(`GC=F`), type = "log")
silver_ret <- dailyReturn(Cl(`SI=F`), type = "log")

# Combine and reshape to long format
returns_long <- tibble(
  date = index(gold_ret),
  Gold = as.numeric(gold_ret),
  Silver = as.numeric(silver_ret)
) |>
  drop_na() |>
  pivot_longer(cols = c(Gold, Silver), names_to = "Metal", values_to = "Return")
```

---

## Plot Daily Returns

This plot shows the raw time series of **daily log returns** for gold and silver.  
It helps the reader visually compare **volatility over time** — wider fluctuations suggest higher variance.

```{r plot-returns}
ggplot(returns_long, aes(x = date, y = Return, color = Metal)) +
  geom_line(alpha = 0.6) +
  labs(
    title = "Daily Log Returns for Gold and Silver (August–Present)",
    x = "Date", y = "Daily Log Return",
    color = "Metal"
  ) +
  theme_minimal()
```

**Analysis:**  
We observe that silver (in blue) exhibits more frequent and larger daily swings compared to gold.  
This visual pattern suggests that silver may indeed have higher volatility — which we now test more formally.

---

## Define Permutation Function

This function performs **one simulation** of the null hypothesis by randomly shuffling the `Metal` labels.  
This breaks the link between returns and metal type, simulating a world where there is no real difference in volatility.

```{r simulate-diff}
# This function simulates one permutation of the null hypothesis
simulate_diff_sd <- function(df) {
  df |>
    mutate(Metal = sample(Metal)) |>
    group_by(Metal) |>
    summarise(sd = sd(Return), .groups = "drop") |>
    summarise(diff_sd = diff(sd)) |>
    pull(diff_sd)
}
```

---

## Observed Difference in SD

We compute the **actual observed difference** in standard deviations — this is our test statistic.  
A positive value means silver is more volatile than gold.

```{r observed-diff}
obs_diff <- returns_long |>
  group_by(Metal) |>
  summarise(sd = sd(Return), .groups = "drop") |>
  summarise(diff_sd = diff(sd)) |>
  pull(diff_sd)

obs_diff
```

**Interpretation:**  
This number captures how much larger silver's return variability is, compared to gold’s.  
We’ll compare this observed difference to the null distribution next.

---

## Simulate Null Distribution

We repeat the permutation process **1000 times** using `map_dbl()` to create a distribution of SD differences expected under the null hypothesis (i.e., if metals were equally volatile). The map_() function allows us to repeat this process smoothly and efficiently. 

```{r simulate-null}
set.seed(47)

# Perform 1000 permutations under the null hypothesis
sim_diffs <- map_dbl(1:1000, ~simulate_diff_sd(returns_long))

# Store in tibble for plotting
sim_df <- tibble(diff_sd = sim_diffs)
```

---

## Visualize Permutation Distribution

This histogram shows the **null distribution** of SD differences.  
The red dashed line represents the actual observed difference.  
If it's far to the right, that provides evidence that silver is truly more volatile.

```{r plot-null}
ggplot(sim_df, aes(x = diff_sd)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "white") +
  geom_vline(xintercept = obs_diff, color = "red", linetype = "dashed", size = 1) +
  labs(
    title = "Permutation Distribution of Difference in Volatility (Silver − Gold)",
    subtitle = "Red dashed line shows the observed difference",
    x = "Difference in SD under Null (permuted)",
    y = "Count"
  ) +
  theme_minimal()
```

**Interpretation:**  
The observed value lies far in the upper tail of the distribution — suggesting that such a large difference would be **very unlikely by chance** if the metals were equally volatile.

---

## Calculate One-Tailed p-value

We calculate the **proportion of permuted SD differences** that are greater than or equal to the observed one.  
This gives a **right-tailed p-value** for the hypothesis that silver is more volatile than gold.

```{r p-value}
# One-tailed test: is Silver more volatile than Gold?
p_val <- mean(sim_diffs >= obs_diff)

cat("Observed difference in SD (Silver − Gold):", round(obs_diff, 5), "\n")
cat("Approximate one-tailed permutation p-value:",
    format(p_val, scientific = TRUE, digits = 10), "\n")
```

**Interpretation:**  
A very small p-value implies that the observed volatility difference is unlikely under the null —  
we have statistical evidence to **reject the null hypothesis** and conclude that **silver is more volatile**.


## Simulation: Type I Error Rate of the Permutation Test

We now simulate a world where **gold and silver have the same true volatility**, and check how often our permutation test **falsely rejects the null**.

This helps us assess how well the test controls the Type I error rate.

```{r simulate-type1}
simulate_type1_error <- function(n = 30, reps = 20, perms = 100, seed = 47) {
  set.seed(seed)  # ensures reproducibility

  p_vals <- numeric(reps)

  for (i in 1:reps) {
    group1 <- rnorm(n)
    group2 <- rnorm(n)

    df <- tibble(
      Return = c(group1, group2),
      Metal = rep(c("Gold", "Silver"), each = n)
    )

    obs_diff <- df |>
      group_by(Metal) |>
      summarise(sd = sd(Return), .groups = "drop") |>
      summarise(diff_sd = diff(sd)) |>
      pull(diff_sd)

    sim_diffs <- replicate(perms, {
      df |>
        mutate(Metal = sample(Metal)) |>
        group_by(Metal) |>
        summarise(sd = sd(Return), .groups = "drop") |>
        summarise(diff_sd = diff(sd)) |>
        pull(diff_sd)
    })

    p_vals[i] <- mean(sim_diffs >= obs_diff)
  }

  mean(p_vals < 0.05)
}

simulate_type1_error(n = 30, reps = 20, perms = 100)

```

**Interpretation:**  
This number tells us how often the permutation test **incorrectly rejects H₀** when there is no true difference.  

While it differs depending on the seed, 47 gives us .05. The test is behaving well, giving us a Type I Error only .05 of the time If much higher or lower, it may be too liberal or conservative under certain conditions.

## Final Conclusion

This simulation-based test supports the claim that silver exhibits **greater daily price variability** than gold from August to October 2025.  
Given the industrial use of silver and its smaller market size, this result is consistent with economic intuition: silver’s price tends to react more sharply to both macroeconomic shocks and commodity supply disruptions.

The one-tailed permutation test not only confirms this difference but does so **without relying on normality assumptions**, making it a robust method for comparing volatility in real-world financial data.
